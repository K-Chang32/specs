<script>
  structLocs = {
    "Actor":                   "data_structures",
    "Address":                 "detail/address",
    "Block":                   "data_structures",
    "ElectionProof":           "data_structures",
    "Message":                 "data_structures",
    "Signature":               "data_structures",
    "SignedMessage":           "data_structures",
    "Ticket":                  "data_structures",
    "TipSet":                  "data_structures",
    "UnsignedMessage":         "data_structures",
    // "ChainManager_BlockState": "impl/chain_manager",
  };

  structRefs = {
    "AddressId":               "Address",
    "AddressSecp256k1":        "Address",
    "AddressActor":            "Address",
    "AddressBLS12_381":        "Address",
    "TxMeta":                  "Block",
  };

  fillSingleCodeRef = (x, isTokenDef) => {
    let origKey = x.innerText;
    let key = origKey;
    let newKey = structRefs[key];
    if (newKey !== undefined) {
      key = newKey;
    }
    let res = structLocs[key];

    if (res !== undefined) {
      if (x.className == "nx" && isTokenDef) {
        x.innerHTML = "<span id=go__" + origKey + "><a href=\"/docs/" + res + "/#go__" + origKey + "\">" + x.innerHTML + "</a></div>";
      } else {
        x.innerHTML = "<a href=\"/docs/" + res + "/#go__" + origKey + "\">" + x.innerHTML + "</a>";
      }
    }
  };

  fillCodeRefs = (xs, parent) => {
    if (xs.length == 0 && parent.innerText.length != 0) {
      fillSingleCodeRef(parent);
      return;
    }

    let isTokenDef = false;

    for (let x of xs) {
      if (x.className == "kd" && x.innerHTML == "type") {
        isTokenDef = true;
        continue;
      }

      if (x.className != "nx" && x.className != "codeRef") {
        continue;
      }

      fillSingleCodeRef(x, isTokenDef);
      isTokenDef = false;
    }
  };

  window.onload = (event) => {
    let codeBlocks = document.getElementsByTagName("code");
    for (let codeBlock of codeBlocks) {
      fillCodeRefs(codeBlock.children, codeBlock);
    }

    let hashPrev = location.hash;
    if ((typeof hashPrev) == "string" && hashPrev != "") {
      location.hash = "";
      location.hash = hashPrev;
    }
  };
</script>
