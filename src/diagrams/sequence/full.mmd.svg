<svg id="mermaid-1569372373628" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:5760px;" viewBox="-50 -10 5760 6593"><style>#mermaid-1569372373628 .label{font-family:trebuchet ms,verdana,arial;color:#333}#mermaid-1569372373628 .node circle,#mermaid-1569372373628 .node ellipse,#mermaid-1569372373628 .node polygon,#mermaid-1569372373628 .node rect{fill:#ececff;stroke:#9370db;stroke-width:1px}#mermaid-1569372373628 .node.clickable{cursor:pointer}#mermaid-1569372373628 .arrowheadPath{fill:#333}#mermaid-1569372373628 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1569372373628 .edgeLabel{background-color:#e8e8e8}#mermaid-1569372373628 .cluster rect{fill:#ffffde!important;stroke:#aa3!important;stroke-width:1px!important}#mermaid-1569372373628 .cluster text{fill:#333}#mermaid-1569372373628 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:trebuchet ms,verdana,arial;font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1569372373628 .actor{stroke:#ccf;fill:#ececff}#mermaid-1569372373628 text.actor{fill:#000;stroke:none}#mermaid-1569372373628 .actor-line{stroke:grey}#mermaid-1569372373628 .messageLine0{marker-end:"url(#arrowhead)"}#mermaid-1569372373628 .messageLine0,#mermaid-1569372373628 .messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#mermaid-1569372373628 #arrowhead{fill:#333}#mermaid-1569372373628 #crosshead path{fill:#333!important;stroke:#333!important}#mermaid-1569372373628 .messageText{fill:#333;stroke:none}#mermaid-1569372373628 .labelBox{stroke:#ccf;fill:#ececff}#mermaid-1569372373628 .labelText,#mermaid-1569372373628 .loopText{fill:#000;stroke:none}#mermaid-1569372373628 .loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#ccf}#mermaid-1569372373628 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1569372373628 .noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}#mermaid-1569372373628 .section{stroke:none;opacity:.2}#mermaid-1569372373628 .section0{fill:rgba(102,102,255,.49)}#mermaid-1569372373628 .section2{fill:#fff400}#mermaid-1569372373628 .section1,#mermaid-1569372373628 .section3{fill:#fff;opacity:.2}#mermaid-1569372373628 .sectionTitle0,#mermaid-1569372373628 .sectionTitle1,#mermaid-1569372373628 .sectionTitle2,#mermaid-1569372373628 .sectionTitle3{fill:#333}#mermaid-1569372373628 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px}#mermaid-1569372373628 .grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}#mermaid-1569372373628 .grid path{stroke-width:0}#mermaid-1569372373628 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1569372373628 .task{stroke-width:2}#mermaid-1569372373628 .taskText{text-anchor:middle;font-size:11px}#mermaid-1569372373628 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}#mermaid-1569372373628 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1569372373628 .taskText0,#mermaid-1569372373628 .taskText1,#mermaid-1569372373628 .taskText2,#mermaid-1569372373628 .taskText3{fill:#fff}#mermaid-1569372373628 .task0,#mermaid-1569372373628 .task1,#mermaid-1569372373628 .task2,#mermaid-1569372373628 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1569372373628 .taskTextOutside0,#mermaid-1569372373628 .taskTextOutside1,#mermaid-1569372373628 .taskTextOutside2,#mermaid-1569372373628 .taskTextOutside3{fill:#000}#mermaid-1569372373628 .active0,#mermaid-1569372373628 .active1,#mermaid-1569372373628 .active2,#mermaid-1569372373628 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1569372373628 .activeText0,#mermaid-1569372373628 .activeText1,#mermaid-1569372373628 .activeText2,#mermaid-1569372373628 .activeText3{fill:#000!important}#mermaid-1569372373628 .done0,#mermaid-1569372373628 .done1,#mermaid-1569372373628 .done2,#mermaid-1569372373628 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1569372373628 .doneText0,#mermaid-1569372373628 .doneText1,#mermaid-1569372373628 .doneText2,#mermaid-1569372373628 .doneText3{fill:#000!important}#mermaid-1569372373628 .crit0,#mermaid-1569372373628 .crit1,#mermaid-1569372373628 .crit2,#mermaid-1569372373628 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1569372373628 .activeCrit0,#mermaid-1569372373628 .activeCrit1,#mermaid-1569372373628 .activeCrit2,#mermaid-1569372373628 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1569372373628 .doneCrit0,#mermaid-1569372373628 .doneCrit1,#mermaid-1569372373628 .doneCrit2,#mermaid-1569372373628 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1569372373628 .activeCritText0,#mermaid-1569372373628 .activeCritText1,#mermaid-1569372373628 .activeCritText2,#mermaid-1569372373628 .activeCritText3,#mermaid-1569372373628 .doneCritText0,#mermaid-1569372373628 .doneCritText1,#mermaid-1569372373628 .doneCritText2,#mermaid-1569372373628 .doneCritText3{fill:#000!important}#mermaid-1569372373628 .titleText{text-anchor:middle;font-size:18px;fill:#000}#mermaid-1569372373628 g.classGroup text{fill:#9370db;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}#mermaid-1569372373628 g.classGroup rect{fill:#ececff;stroke:#9370db}#mermaid-1569372373628 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1569372373628 .classLabel .box{stroke:none;stroke-width:0;fill:#ececff;opacity:.5}#mermaid-1569372373628 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1569372373628 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1569372373628 #compositionEnd,#mermaid-1569372373628 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1569372373628 #aggregationEnd,#mermaid-1569372373628 #aggregationStart{fill:#ececff;stroke:#9370db;stroke-width:1}#mermaid-1569372373628 #dependencyEnd,#mermaid-1569372373628 #dependencyStart,#mermaid-1569372373628 #extensionEnd,#mermaid-1569372373628 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1569372373628 .branch-label,#mermaid-1569372373628 .commit-id,#mermaid-1569372373628 .commit-msg{fill:#d3d3d3;color:#d3d3d3}</style><style>#mermaid-1569372373628 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal "Times New Roman";
  }</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">RetrievalClient</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">RetrievalProvider</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">StorageClient</tspan></text></g><g><line id="actor3" x1="675" y1="5" x2="675" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="675" dy="0">StorageProvider</tspan></text></g><g><line id="actor4" x1="875" y1="5" x2="875" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="800" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="875" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="875" dy="0">PaymentChannelActor</tspan></text></g><g><line id="actor5" x1="1075" y1="5" x2="1075" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1000" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1075" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1075" dy="0">PaymentsSubsystem</tspan></text></g><g><line id="actor6" x1="1275" y1="5" x2="1275" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1275" dy="0">BlockchainSubsystem</tspan></text></g><g><line id="actor7" x1="1475" y1="5" x2="1475" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1475" dy="0">BlockSyncer</tspan></text></g><g><line id="actor8" x1="1675" y1="5" x2="1675" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1675" dy="0">BlockProducer</tspan></text></g><g><line id="actor9" x1="1875" y1="5" x2="1875" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1800" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1875" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1875" dy="0">StoragePowerConsensusSubsystem</tspan></text></g><g><line id="actor10" x1="2075" y1="5" x2="2075" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2000" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2075" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2075" dy="0">StoragePowerActor</tspan></text></g><g><line id="actor11" x1="2275" y1="5" x2="2275" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2275" dy="0">StorageMiningSubsystem</tspan></text></g><g><line id="actor12" x1="2475" y1="5" x2="2475" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2475" dy="0">StorageMinerActor</tspan></text></g><g><line id="actor13" x1="2675" y1="5" x2="2675" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2675" dy="0">SectorIndexerSubsystem</tspan></text></g><g><line id="actor14" x1="2875" y1="5" x2="2875" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2800" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2875" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2875" dy="0">StorageProvingSubsystem</tspan></text></g><g><line id="actor15" x1="3075" y1="5" x2="3075" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="3000" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3075" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3075" dy="0">FilecoinProofsSubsystem</tspan></text></g><g><line id="actor16" x1="3275" y1="5" x2="3275" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="3200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3275" dy="0">ClockSubsystem</tspan></text></g><g><line id="actor17" x1="3475" y1="5" x2="3475" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="3400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3475" dy="0">libp2p</tspan></text></g><g><line id="actor18" x1="3675" y1="5" x2="3675" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="3600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3675" dy="0">SectorSealer</tspan></text></g><g><line id="actor19" x1="3875" y1="5" x2="3875" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="3800" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3875" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3875" dy="0">PoStSubmission</tspan></text></g><g><line id="actor20" x1="4075" y1="5" x2="4075" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="4000" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4075" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4075" dy="0">WallClock</tspan></text></g><g><line id="actor21" x1="4275" y1="5" x2="4275" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="4200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4275" dy="0">Blockchain</tspan></text></g><g><line id="actor22" x1="4475" y1="5" x2="4475" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="4400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4475" dy="0">MessagePool</tspan></text></g><g><line id="actor23" x1="4675" y1="5" x2="4675" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="4600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4675" dy="0">MiningScheduler</tspan></text></g><g><line id="actor24" x1="4875" y1="5" x2="4875" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="4800" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4875" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4875" dy="0">StorageMinerSubsystem</tspan></text></g><g><line id="actor25" x1="5075" y1="5" x2="5075" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="5000" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="5075" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="5075" dy="0">CronActor</tspan></text></g><g><line id="actor26" x1="5275" y1="5" x2="5275" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="5200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="5275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="5275" dy="0">StorageMarketActor</tspan></text></g><g><line id="actor27" x1="5475" y1="5" x2="5475" y2="6582" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="5400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="5475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="5475" dy="0">FaultArbitration</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="50" y="75" fill="#EDF2AE" stroke="#666" width="250" height="36" rx="0" ry="0" class="note"></rect><text x="46" y="99" fill="black" class="noteText"><tspan x="66" fill="black">RetrievalMarketSubsystem</tspan></text></g><g><rect x="450" y="121" fill="#EDF2AE" stroke="#666" width="250" height="36" rx="0" ry="0" class="note"></rect><text x="446" y="145" fill="black" class="noteText"><tspan x="466" fill="black">StorageMarketSubsystem</tspan></text></g><g><rect x="1250" y="167" fill="#EDF2AE" stroke="#666" width="850" height="36" rx="0" ry="0" class="note"></rect><text x="1246" y="191" fill="black" class="noteText"><tspan x="1266" fill="black">BlockchainGroup</tspan></text></g><g><rect x="2250" y="213" fill="#EDF2AE" stroke="#666" width="650" height="36" rx="0" ry="0" class="note"></rect><text x="2246" y="237" fill="black" class="noteText"><tspan x="2266" fill="black">MiningGroup</tspan></text></g><g><text x="175" y="302" class="messageText" style="text-anchor: middle;">DealProposal</text><line x1="75" y1="309" x2="275" y2="309" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="270" y="311" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="172.5" y="337" class="messageText" style="text-anchor: middle;">{Accepted, Rejected}</text><line x1="270" y1="344" x2="75" y2="344" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="65" y1="259" x2="290" y2="259" class="loopLine"></line><line x1="290" y1="259" x2="290" y2="354" class="loopLine"></line><line x1="65" y1="354" x2="290" y2="354" class="loopLine"></line><line x1="65" y1="259" x2="65" y2="354" class="loopLine"></line><polygon points="65,259 115,259 115,272 106.6,279 65,279" class="labelBox"></polygon><text x="72.5" y="274" fill="black" class="labelText"><tspan x="72.5" fill="black">opt</tspan></text><text x="177.5" y="274" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="177.5" fill="black">[ RetrievalDealMake ]</tspan></text></g><g><text x="175" y="407" class="messageText" style="text-anchor: middle;">Query(CID)</text><line x1="75" y1="414" x2="275" y2="414" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="270" y="416" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="172.5" y="442" class="messageText" style="text-anchor: middle;">MinPrice, Unavail</text><line x1="270" y1="449" x2="75" y2="449" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="65" y1="364" x2="290" y2="364" class="loopLine"></line><line x1="290" y1="364" x2="290" y2="459" class="loopLine"></line><line x1="65" y1="459" x2="290" y2="459" class="loopLine"></line><line x1="65" y1="364" x2="65" y2="459" class="loopLine"></line><polygon points="65,364 115,364 115,377 106.6,384 65,384" class="labelBox"></polygon><text x="72.5" y="379" fill="black" class="labelText"><tspan x="72.5" fill="black">opt</tspan></text><text x="177.5" y="379" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="177.5" fill="black">[ RetrievalQuery ]</tspan></text></g><g><text x="2275" y="512" class="messageText" style="text-anchor: middle;">CreateMiner(ownerPubKey PubKey, workerPubKey PubKey, pledgeAmt TokenAmount)</text><path d="M 2275,519 C 2335,509 2335,549 2275,539" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2175" y="577" class="messageText" style="text-anchor: middle;">RegisterMiner(OwnerAddr, WorkerPubKey)</text><line x1="2275" y1="584" x2="2075" y2="584" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="2070" y="586" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2177.5" y="612" class="messageText" style="text-anchor: middle;">StorageMinerActor</text><line x1="2080" y1="619" x2="2275" y2="619" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="1978.875" y1="469" x2="2571.125" y2="469" class="loopLine"></line><line x1="2571.125" y1="469" x2="2571.125" y2="629" class="loopLine"></line><line x1="1978.875" y1="629" x2="2571.125" y2="629" class="loopLine"></line><line x1="1978.875" y1="469" x2="1978.875" y2="629" class="loopLine"></line><polygon points="1978.875,469 2028.875,469 2028.875,482 2020.475,489 1978.875,489" class="labelBox"></polygon><text x="1986.375" y="484" fill="black" class="labelText"><tspan x="1986.375" fill="black">opt</tspan></text><text x="2275" y="484" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2275" fill="black">[ RegisterStorageMiner ]</tspan></text></g><g><rect x="300" y="664" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="296" y="688" fill="black" class="noteText"><tspan x="316" fill="black">Piece, PieceCID</tspan></text></g><g><text x="575" y="728" class="messageText" style="text-anchor: middle;">ProposeStorageDeal(StorageDealProposal)</text><line x1="475" y1="735" x2="675" y2="735" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="575" y="763" class="messageText" style="text-anchor: middle;">QueryStorageDealStatus(StorageDealQuery)</text><line x1="475" y1="770" x2="675" y2="770" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="670" y="772" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="572.5" y="798" class="messageText" style="text-anchor: middle;">StorageDealResponse{StorageDealAccepted, Deal}</text><line x1="670" y1="805" x2="475" y2="805" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><rect x="300" y="815" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="296" y="839" fill="black" class="noteText"><tspan x="316" fill="black">Piece, PieceCID, Deal</tspan></text></g><g><rect x="700" y="861" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="696" y="885" fill="black" class="noteText"><tspan x="716" fill="black">Piece, PieceCID, Deal</tspan></text></g><g><text x="575" y="925" class="messageText" style="text-anchor: middle;">QueryStorageDealStatus(StorageDealQuery)</text><line x1="475" y1="932" x2="675" y2="932" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="670" y="934" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="572.5" y="960" class="messageText" style="text-anchor: middle;">StorageDealResponse{StorageDealStarted, Deal}</text><line x1="670" y1="967" x2="475" y2="967" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="290" y1="639" x2="860" y2="639" class="loopLine"></line><line x1="860" y1="639" x2="860" y2="977" class="loopLine"></line><line x1="290" y1="977" x2="860" y2="977" class="loopLine"></line><line x1="290" y1="639" x2="290" y2="977" class="loopLine"></line><polygon points="290,639 340,639 340,652 331.6,659 290,659" class="labelBox"></polygon><text x="297.5" y="654" fill="black" class="labelText"><tspan x="297.5" fill="black">opt</tspan></text><text x="575" y="654" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="575" fill="black">[ StorageDealMake ]</tspan></text></g><g><text x="1475" y="1030" class="messageText" style="text-anchor: middle;">HandleStorageDeal(Deal, PieceRef)</text><line x1="675" y1="1037" x2="2275" y2="1037" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="2270" y="1039" fill="#f4f4f4" stroke="#666" width="10" height="233" rx="0" ry="0"></rect></g><g><text x="2477.5" y="1065" class="messageText" style="text-anchor: middle;">AddPieceToSector(Deal, SectorID)</text><line x1="2280" y1="1072" x2="2675" y2="1072" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="2670" y="1074" fill="#f4f4f4" stroke="#666" width="10" height="163" rx="0" ry="0"></rect></g><g><text x="2680" y="1100" class="messageText" style="text-anchor: middle;">IndexSectorByDealExpiration(SectorID, Deal)</text><path d="M 2680,1107 C 2740,1097 2740,1137 2680,1127" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2680" y="1165" class="messageText" style="text-anchor: middle;">PIP ← GetPieceInclusionProof(Deal)</text><path d="M 2680,1172 C 2740,1162 2740,1202 2680,1192" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2475" y="1230" class="messageText" style="text-anchor: middle;">SectorID</text><line x1="2670" y1="1237" x2="2280" y2="1237" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1472.5" y="1265" class="messageText" style="text-anchor: middle;">NotifyStorageDealStaged(Deal,PieceRef,PIP,SectorID)</text><line x1="2270" y1="1272" x2="675" y2="1272" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="665" y1="987" x2="2840.171875" y2="987" class="loopLine"></line><line x1="2840.171875" y1="987" x2="2840.171875" y2="1282" class="loopLine"></line><line x1="665" y1="1282" x2="2840.171875" y2="1282" class="loopLine"></line><line x1="665" y1="987" x2="665" y2="1282" class="loopLine"></line><polygon points="665,987 715,987 715,1000 706.6,1007 665,1007" class="labelBox"></polygon><text x="672.5" y="1002" fill="black" class="labelText"><tspan x="672.5" fill="black">opt</tspan></text><text x="1752.5859375" y="1002" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="1752.5859375" fill="black">[ AddingDealToSector ]</tspan></text></g><g><text x="575" y="1335" class="messageText" style="text-anchor: middle;">QueryStorageDealStatus(StorageDealQuery)</text><line x1="475" y1="1342" x2="675" y2="1342" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="670" y="1344" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="572.5" y="1370" class="messageText" style="text-anchor: middle;">StorageDealResponse{StorageDealStaged,Deal,PIP}</text><line x1="670" y1="1377" x2="475" y2="1377" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="465" y1="1292" x2="690" y2="1292" class="loopLine"></line><line x1="690" y1="1292" x2="690" y2="1387" class="loopLine"></line><line x1="465" y1="1387" x2="690" y2="1387" class="loopLine"></line><line x1="465" y1="1292" x2="465" y2="1387" class="loopLine"></line><polygon points="465,1292 515,1292 515,1305 506.6,1312 465,1312" class="labelBox"></polygon><text x="472.5" y="1307" fill="black" class="labelText"><tspan x="472.5" fill="black">opt</tspan></text><text x="577.5" y="1307" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="577.5" fill="black">[ ClientQuery ]</tspan></text></g><g><text x="2075" y="1440" class="messageText" style="text-anchor: middle;">GetSealSeed(Chain, Epoch)</text><line x1="2275" y1="1447" x2="1875" y2="1447" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1870" y="1449" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2077.5" y="1475" class="messageText" style="text-anchor: middle;">Seed</text><line x1="1880" y1="1482" x2="2275" y2="1482" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2575" y="1510" class="messageText" style="text-anchor: middle;">SealSector(Seed, SectorID, ReplicaCfg)</text><line x1="2275" y1="1517" x2="2875" y2="1517" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="2870" y="1519" fill="#f4f4f4" stroke="#666" width="10" height="103" rx="0" ry="0"></rect></g><g><text x="3277.5" y="1545" class="messageText" style="text-anchor: middle;">Seal(Seed, SectorID, ReplicaCfg)</text><line x1="2880" y1="1552" x2="3675" y2="1552" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="3670" y="1554" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="3275" y="1580" class="messageText" style="text-anchor: middle;">SealOutputs</text><line x1="3670" y1="1587" x2="2880" y2="1587" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2572.5" y="1615" class="messageText" style="text-anchor: middle;">SealOutputs</text><line x1="2870" y1="1622" x2="2275" y2="1622" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2375" y="1675" class="messageText" style="text-anchor: middle;">CommitSector(Seed, SectorID, SealCommitment, SealProof)</text><line x1="2275" y1="1682" x2="2475" y2="1682" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2775" y="1710" class="messageText" style="text-anchor: middle;">VerifySeal(SectorID, OnSectorInfo)</text><line x1="2475" y1="1717" x2="3075" y2="1717" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="3070" y="1719" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2772.5" y="1745" class="messageText" style="text-anchor: middle;">{1,0}</text><line x1="3070" y1="1752" x2="2475" y2="1752" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2275" y="1805" class="messageText" style="text-anchor: middle;">IncrementPower(StorageMiner.WorkerPubKey)</text><line x1="2475" y1="1812" x2="2075" y2="1812" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2375" y="1860" class="messageText" style="text-anchor: middle;">CommitSectorError</text><line x1="2475" y1="1867" x2="2275" y2="1867" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="2065" y1="1762" x2="2485" y2="1762" class="loopLine"></line><line x1="2485" y1="1762" x2="2485" y2="1877" class="loopLine"></line><line x1="2065" y1="1877" x2="2485" y2="1877" class="loopLine"></line><line x1="2065" y1="1762" x2="2065" y2="1877" class="loopLine"></line><line x1="2065" y1="1822" x2="2485" y2="1822" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="2065,1762 2115,1762 2115,1775 2106.6,1782 2065,1782" class="labelBox"></polygon><text x="2072.5" y="1777" fill="black" class="labelText"><tspan x="2072.5" fill="black">alt</tspan></text><text x="2275" y="1777" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2275" fill="black">[ 1 - success ]</tspan></text><text x="2275" y="1837" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2275" fill="black">[ 0 - failure ]</tspan></text></g><g><line x1="2055" y1="1632" x2="3090" y2="1632" class="loopLine"></line><line x1="3090" y1="1632" x2="3090" y2="1887" class="loopLine"></line><line x1="2055" y1="1887" x2="3090" y2="1887" class="loopLine"></line><line x1="2055" y1="1632" x2="2055" y2="1887" class="loopLine"></line><polygon points="2055,1632 2105,1632 2105,1645 2096.6,1652 2055,1652" class="labelBox"></polygon><text x="2062.5" y="1647" fill="black" class="labelText"><tspan x="2062.5" fill="black">opt</tspan></text><text x="2572.5" y="1647" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2572.5" fill="black">[ CommitSector ]</tspan></text></g><g><line x1="1860" y1="1397" x2="3690" y2="1397" class="loopLine"></line><line x1="3690" y1="1397" x2="3690" y2="1897" class="loopLine"></line><line x1="1860" y1="1897" x2="3690" y2="1897" class="loopLine"></line><line x1="1860" y1="1397" x2="1860" y2="1897" class="loopLine"></line><polygon points="1860,1397 1910,1397 1910,1410 1901.6,1417 1860,1417" class="labelBox"></polygon><text x="1867.5" y="1412" fill="black" class="labelText"><tspan x="1867.5" fill="black">opt</tspan></text><text x="2775" y="1412" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2775" fill="black">[ SealingSector ]</tspan></text></g><g><rect x="3900" y="1932" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="3896" y="1956" fill="black" class="noteText"><tspan x="3916" fill="black">in every proving period</tspan></text></g><g><rect x="3900" y="1978" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="3896" y="2002" fill="black" class="noteText"><tspan x="3916" fill="black">DoneSet</tspan></text></g><g><text x="2075" y="2042" class="messageText" style="text-anchor: middle;">GetPoStChallenge(Chain, Epoch)</text><line x1="2275" y1="2049" x2="1875" y2="2049" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1870" y="2051" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2077.5" y="2077" class="messageText" style="text-anchor: middle;">challenge</text><line x1="1880" y1="2084" x2="2275" y2="2084" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2575" y="2112" class="messageText" style="text-anchor: middle;">GeneratePoSt(challenge, [SectorID])</text><line x1="2275" y1="2119" x2="2875" y2="2119" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g></g><g><text x="2880" y="2147" class="messageText" style="text-anchor: middle;">GeneratePoSt(challenge, [SectorID])</text><path d="M 2880,2154 C 2940,2144 2940,2184 2880,2174" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g></g><g><text x="2572.5" y="2212" class="messageText" style="text-anchor: middle;">GeneratePoSt(challenge, [SectorID])</text><line x1="2275" y1="2219" x2="2870" y2="2219" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="2880" y="2221" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2572.5" y="2247" class="messageText" style="text-anchor: middle;">PoStProof</text><line x1="2870" y1="2254" x2="2275" y2="2254" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2375" y="2282" class="messageText" style="text-anchor: middle;">SubmitPoSt(PoStProof, DoneSet)</text><line x1="2275" y1="2289" x2="2475" y2="2289" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="1860" y1="1907" x2="4060" y2="1907" class="loopLine"></line><line x1="4060" y1="1907" x2="4060" y2="2299" class="loopLine"></line><line x1="1860" y1="2299" x2="4060" y2="2299" class="loopLine"></line><line x1="1860" y1="1907" x2="1860" y2="2299" class="loopLine"></line><polygon points="1860,1907 1910,1907 1910,1920 1901.6,1927 1860,1927" class="labelBox"></polygon><text x="1867.5" y="1922" fill="black" class="labelText"><tspan x="1867.5" fill="black">loop</tspan></text><text x="2960" y="1922" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2960" fill="black">[ PoStSubmission ]</tspan></text></g><g><text x="575" y="2352" class="messageText" style="text-anchor: middle;">QueryStorageDealStatus(StorageDealQuery)</text><line x1="475" y1="2359" x2="675" y2="2359" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="670" y="2361" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="572.5" y="2387" class="messageText" style="text-anchor: middle;">StorageDealResponse{SealingParams,DealComplete,...}</text><line x1="670" y1="2394" x2="475" y2="2394" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="465" y1="2309" x2="690" y2="2309" class="loopLine"></line><line x1="690" y1="2309" x2="690" y2="2404" class="loopLine"></line><line x1="465" y1="2404" x2="690" y2="2404" class="loopLine"></line><line x1="465" y1="2309" x2="465" y2="2404" class="loopLine"></line><polygon points="465,2309 515,2309 515,2322 506.6,2329 465,2329" class="labelBox"></polygon><text x="472.5" y="2324" fill="black" class="labelText"><tspan x="472.5" fill="black">opt</tspan></text><text x="577.5" y="2324" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="577.5" fill="black">[ ClientQuery ]</tspan></text></g><g><rect x="700" y="2439" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="696" y="2463" fill="black" class="noteText"><tspan x="716" fill="black">Deal</tspan></text></g><g><text x="575" y="2528" class="messageText" style="text-anchor: middle;">RequestVouchersApproval(Deal, [Voucher])</text><line x1="675" y1="2535" x2="475" y2="2535" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="470" y="2537" fill="#f4f4f4" stroke="#666" width="10" height="338" rx="0" ry="0"></rect></g><g><text x="577.5" y="2588" class="messageText" style="text-anchor: middle;">QueryStorageDealStatus(StorageDealQuery)</text><line x1="480" y1="2595" x2="675" y2="2595" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="670" y="2597" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="575" y="2623" class="messageText" style="text-anchor: middle;">StorageDealResponse{SealingParams,DealComplete,SectorID, PIP}</text><line x1="670" y1="2630" x2="480" y2="2630" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="480" y="2658" class="messageText" style="text-anchor: middle;">{0, 1} ← VerifyPIP(SectorID, PIP)</text><path d="M 480,2665 C 540,2655 540,2695 480,2685" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><line x1="356.984375" y1="2545" x2="690" y2="2545" class="loopLine"></line><line x1="690" y1="2545" x2="690" y2="2705" class="loopLine"></line><line x1="356.984375" y1="2705" x2="690" y2="2705" class="loopLine"></line><line x1="356.984375" y1="2545" x2="356.984375" y2="2705" class="loopLine"></line><polygon points="356.984375,2545 406.984375,2545 406.984375,2558 398.584375,2565 356.984375,2565" class="labelBox"></polygon><text x="364.484375" y="2560" fill="black" class="labelText"><tspan x="364.484375" fill="black">opt</tspan></text><text x="523.4921875" y="2560" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="523.4921875" fill="black">[ If Client Does Not Have PIP ]</tspan></text></g><g><text x="877.5" y="2733" class="messageText" style="text-anchor: middle;">VerifySectorExists(SectorID)</text><line x1="480" y1="2740" x2="1275" y2="2740" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1270" y="2742" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="875" y="2768" class="messageText" style="text-anchor: middle;">{0, 1}</text><line x1="1270" y1="2775" x2="480" y2="2775" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="480" y="2803" class="messageText" style="text-anchor: middle;">VouchersApprovalResponse ← ApproveVouchers([Voucher])</text><path d="M 480,2810 C 540,2800 540,2840 480,2830" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="577.5" y="2868" class="messageText" style="text-anchor: middle;">VouchersApprovalResponse</text><line x1="480" y1="2875" x2="675" y2="2875" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="775" y="2903" class="messageText" style="text-anchor: middle;">RedeemVoucherWithApproval(VoucherApprovalResponse.Voucher)</text><line x1="675" y1="2910" x2="875" y2="2910" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="775" y="2958" class="messageText" style="text-anchor: middle;">RedeemVoucherWithPIP(Voucher, PIP)</text><line x1="675" y1="2965" x2="875" y2="2965" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="272.703125" y1="2485" x2="1290" y2="2485" class="loopLine"></line><line x1="1290" y1="2485" x2="1290" y2="2975" class="loopLine"></line><line x1="272.703125" y1="2975" x2="1290" y2="2975" class="loopLine"></line><line x1="272.703125" y1="2485" x2="272.703125" y2="2975" class="loopLine"></line><line x1="272.703125" y1="2920" x2="1290" y2="2920" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="272.703125,2485 322.703125,2485 322.703125,2498 314.303125,2505 272.703125,2505" class="labelBox"></polygon><text x="280.203125" y="2500" fill="black" class="labelText"><tspan x="280.203125" fill="black">alt</tspan></text><text x="781.3515625" y="2500" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="781.3515625" fill="black">[ Via Client ]</tspan></text><text x="781.3515625" y="2935" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="781.3515625" fill="black">[ Via Blockchain ]</tspan></text></g><g><line x1="262.703125" y1="2414" x2="1300" y2="2414" class="loopLine"></line><line x1="1300" y1="2414" x2="1300" y2="2985" class="loopLine"></line><line x1="262.703125" y1="2985" x2="1300" y2="2985" class="loopLine"></line><line x1="262.703125" y1="2414" x2="262.703125" y2="2985" class="loopLine"></line><polygon points="262.703125,2414 312.703125,2414 312.703125,2427 304.303125,2434 262.703125,2434" class="labelBox"></polygon><text x="270.203125" y="2429" fill="black" class="labelText"><tspan x="270.203125" fill="black">loop</tspan></text><text x="781.3515625" y="2429" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="781.3515625" fill="black">[ StorageDealCollect ]</tspan></text></g><g><text x="2475" y="3038" class="messageText" style="text-anchor: middle;">Subscribe(OnNewBlock)</text><line x1="1475" y1="3045" x2="3475" y2="3045" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="3470" y="3047" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2472.5" y="3073" class="messageText" style="text-anchor: middle;">Event(OnNewBlock, block)</text><line x1="3470" y1="3080" x2="1475" y2="3080" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1475" y="3108" class="messageText" style="text-anchor: middle;">ValidateBlockSyntax(block)</text><path d="M 1475,3115 C 1535,3105 1535,3145 1475,3135" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="1375" y="3173" class="messageText" style="text-anchor: middle;">HandleBlock(block)</text><line x1="1475" y1="3180" x2="1275" y2="3180" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1270" y="3182" fill="#f4f4f4" stroke="#666" width="10" height="198" rx="0" ry="0"></rect></g><g><text x="1280" y="3208" class="messageText" style="text-anchor: middle;">ValidateBlock(block)</text><path d="M 1280,3215 C 1340,3205 1340,3245 1280,3235" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="1577.5" y="3273" class="messageText" style="text-anchor: middle;">ValidateBlock(block)</text><line x1="1280" y1="3280" x2="1875" y2="3280" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2177.5" y="3308" class="messageText" style="text-anchor: middle;">ValidateBlock(block)</text><line x1="1280" y1="3315" x2="3075" y2="3315" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="1280" y="3343" class="messageText" style="text-anchor: middle;">StateTree ← TryGenerateStateTree(block)</text><path d="M 1280,3350 C 1340,3340 1340,3380 1280,3370" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2675" y="3433" class="messageText" style="text-anchor: middle;">AssembleTipsets()</text><line x1="4075" y1="3440" x2="1275" y2="3440" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1275" y="3468" class="messageText" style="text-anchor: middle;">[Tipset] ← AssembleTipsets()</text><path d="M 1275,3475 C 1335,3465 1335,3505 1275,3495" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="1275" y="3533" class="messageText" style="text-anchor: middle;">Tipset ← ChooseTipset([Tipset])</text><path d="M 1275,3540 C 1335,3530 1335,3570 1275,3560" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2775" y="3598" class="messageText" style="text-anchor: middle;">ApplyStateTree(StateTree)</text><line x1="1275" y1="3605" x2="4275" y2="3605" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="1159.1875" y1="3390" x2="4285" y2="3390" class="loopLine"></line><line x1="4285" y1="3390" x2="4285" y2="3615" class="loopLine"></line><line x1="1159.1875" y1="3615" x2="4285" y2="3615" class="loopLine"></line><line x1="1159.1875" y1="3390" x2="1159.1875" y2="3615" class="loopLine"></line><polygon points="1159.1875,3390 1209.1875,3390 1209.1875,3403 1200.7875,3410 1159.1875,3410" class="labelBox"></polygon><text x="1166.6875" y="3405" fill="black" class="labelText"><tspan x="1166.6875" fill="black">alt</tspan></text><text x="2722.09375" y="3405" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2722.09375" fill="black">[ Round Cutoff ]</tspan></text></g><g><line x1="1134.015625" y1="2995" x2="4295" y2="2995" class="loopLine"></line><line x1="4295" y1="2995" x2="4295" y2="3625" class="loopLine"></line><line x1="1134.015625" y1="3625" x2="4295" y2="3625" class="loopLine"></line><line x1="1134.015625" y1="2995" x2="1134.015625" y2="3625" class="loopLine"></line><polygon points="1134.015625,2995 1184.015625,2995 1184.015625,3008 1175.615625,3015 1134.015625,3015" class="labelBox"></polygon><text x="1141.515625" y="3010" fill="black" class="labelText"><tspan x="1141.515625" fill="black">loop</tspan></text><text x="2714.5078125" y="3010" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2714.5078125" fill="black">[ BlockReception ]</tspan></text></g><g><text x="1775" y="3703" class="messageText" style="text-anchor: middle;">OnNewTipset(Chain, Epoch)</text><line x1="1275" y1="3710" x2="2275" y2="3710" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="3175" y="3758" class="messageText" style="text-anchor: middle;">OnNewRound()</text><line x1="4075" y1="3765" x2="2275" y2="3765" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="4100" y="3775" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="4096" y="3799" fill="black" class="noteText"><tspan x="4116" fill="black">epoch is incremented by 1</tspan></text></g><g><line x1="1265" y1="3660" x2="4260" y2="3660" class="loopLine"></line><line x1="4260" y1="3660" x2="4260" y2="3821" class="loopLine"></line><line x1="1265" y1="3821" x2="4260" y2="3821" class="loopLine"></line><line x1="1265" y1="3660" x2="1265" y2="3821" class="loopLine"></line><line x1="1265" y1="3720" x2="4260" y2="3720" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1265,3660 1315,3660 1315,3673 1306.6,3680 1265,3680" class="labelBox"></polygon><text x="1272.5" y="3675" fill="black" class="labelText"><tspan x="1272.5" fill="black">alt</tspan></text><text x="2762.5" y="3675" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2762.5" fill="black">[ New Tipset ]</tspan></text><text x="2762.5" y="3735" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2762.5" fill="black">[ Null block last round ]</tspan></text></g><g><text x="2075" y="3849" class="messageText" style="text-anchor: middle;">GetElectionArtifacts(Chain, Epoch)</text><line x1="2275" y1="3856" x2="1875" y2="3856" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1870" y="3858" fill="#f4f4f4" stroke="#666" width="10" height="163" rx="0" ry="0"></rect></g><g><text x="1880" y="3884" class="messageText" style="text-anchor: middle;">TK ← TicketAtEpoch(Chain, Epoch-k)</text><path d="M 1880,3891 C 1940,3881 1940,3921 1880,3911" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="1880" y="3949" class="messageText" style="text-anchor: middle;">T1 ← TicketAtEpoch(Chain, Epoch-1)</text><path d="M 1880,3956 C 1940,3946 1940,3986 1880,3976" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2077.5" y="4014" class="messageText" style="text-anchor: middle;">TK, T1</text><line x1="1880" y1="4021" x2="2275" y2="4021" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2275" y="4074" class="messageText" style="text-anchor: middle;">EP ← DrawElectionProof(TK.randomness(), StorageMiner.WorkerKey)</text><path d="M 2275,4081 C 2335,4071 2335,4111 2275,4101" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2275" y="4164" class="messageText" style="text-anchor: middle;">T0 ← GenerateNextTicket(T1.randomness(), StorageMiner.WorkerKey)</text><path d="M 2275,4171 C 2335,4161 2335,4201 2275,4191" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2275" y="4249" class="messageText" style="text-anchor: middle;">T1 ← GenerateNextTicket(T0.randomness(), StorageMiner.WorkerKey)</text><path d="M 2275,4256 C 2335,4246 2335,4286 2275,4276" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><rect x="2300" y="4296" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="2296" y="4320" fill="black" class="noteText"><tspan x="2316" fill="black">Using tickets derived in failed election proof in last epoch</tspan></text></g><g><line x1="2033.109375" y1="4121" x2="2516.890625" y2="4121" class="loopLine"></line><line x1="2516.890625" y1="4121" x2="2516.890625" y2="4342" class="loopLine"></line><line x1="2033.109375" y1="4342" x2="2516.890625" y2="4342" class="loopLine"></line><line x1="2033.109375" y1="4121" x2="2033.109375" y2="4342" class="loopLine"></line><line x1="2033.109375" y1="4211" x2="2516.890625" y2="4211" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="2033.109375,4121 2083.109375,4121 2083.109375,4134 2074.709375,4141 2033.109375,4141" class="labelBox"></polygon><text x="2040.609375" y="4136" fill="black" class="labelText"><tspan x="2040.609375" fill="black">alt</tspan></text><text x="2275" y="4136" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2275" fill="black">[ New Tipset ]</tspan></text><text x="2275" y="4226" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2275" fill="black">[ Null block last round ]</tspan></text></g><g><text x="2075" y="4370" class="messageText" style="text-anchor: middle;">TryLeaderElection(EP)</text><line x1="2275" y1="4377" x2="1875" y2="4377" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1870" y="4379" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="2077.5" y="4405" class="messageText" style="text-anchor: middle;">{1, 0}</text><line x1="1880" y1="4412" x2="2275" y2="4412" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1975" y="4465" class="messageText" style="text-anchor: middle;">GenerateBlock(EP, T0, Tipset, StorageMiner.Address)</text><line x1="2275" y1="4472" x2="1675" y2="4472" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="3075" y="4500" class="messageText" style="text-anchor: middle;">GetMostProfitableMessages(StorageMiner.Address)</text><line x1="1675" y1="4507" x2="4475" y2="4507" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="4470" y="4509" fill="#f4f4f4" stroke="#666" width="10" height="33" rx="0" ry="0"></rect></g><g><text x="3072.5" y="4535" class="messageText" style="text-anchor: middle;">[Message]</text><line x1="4470" y1="4542" x2="1675" y2="4542" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1675" y="4570" class="messageText" style="text-anchor: middle;">block ← AssembleBlock([Message], Tipset, EP, T0, StorageMiner.Address)</text><path d="M 1675,4577 C 1735,4567 1735,4607 1675,4597" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="1575" y="4635" class="messageText" style="text-anchor: middle;">PropagateBlock(block)</text><line x1="1675" y1="4642" x2="1475" y2="4642" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="1421.078125" y1="4422" x2="4490" y2="4422" class="loopLine"></line><line x1="4490" y1="4422" x2="4490" y2="4652" class="loopLine"></line><line x1="1421.078125" y1="4652" x2="4490" y2="4652" class="loopLine"></line><line x1="1421.078125" y1="4422" x2="1421.078125" y2="4652" class="loopLine"></line><polygon points="1421.078125,4422 1471.078125,4422 1471.078125,4435 1462.678125,4442 1421.078125,4442" class="labelBox"></polygon><text x="1428.578125" y="4437" fill="black" class="labelText"><tspan x="1428.578125" fill="black">opt</tspan></text><text x="2955.5390625" y="4437" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2955.5390625" fill="black">[ 1- success ]</tspan></text></g><g><line x1="1411.078125" y1="4031" x2="4500" y2="4031" class="loopLine"></line><line x1="4500" y1="4031" x2="4500" y2="4662" class="loopLine"></line><line x1="1411.078125" y1="4662" x2="4500" y2="4662" class="loopLine"></line><line x1="1411.078125" y1="4031" x2="1411.078125" y2="4662" class="loopLine"></line><polygon points="1411.078125,4031 1461.078125,4031 1461.078125,4044 1452.678125,4051 1411.078125,4051" class="labelBox"></polygon><text x="1418.578125" y="4046" fill="black" class="labelText"><tspan x="1418.578125" fill="black">loop</tspan></text><text x="2955.5390625" y="4046" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2955.5390625" fill="black">[ forEach StorageMiningSubsystem.StorageMiner ]</tspan></text></g><g><line x1="1255" y1="3635" x2="4510" y2="3635" class="loopLine"></line><line x1="4510" y1="3635" x2="4510" y2="4672" class="loopLine"></line><line x1="1255" y1="4672" x2="4510" y2="4672" class="loopLine"></line><line x1="1255" y1="3635" x2="1255" y2="4672" class="loopLine"></line><polygon points="1255,3635 1305,3635 1305,3648 1296.6,3655 1255,3655" class="labelBox"></polygon><text x="1262.5" y="3650" fill="black" class="labelText"><tspan x="1262.5" fill="black">loop</tspan></text><text x="2882.5" y="3650" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2882.5" fill="black">[ BlockProduction ]</tspan></text></g><g><text x="1975" y="4750" class="messageText" style="text-anchor: middle;">OnNewTipset(Chain, Epoch)</text><line x1="1275" y1="4757" x2="2675" y2="4757" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2675" y="4785" class="messageText" style="text-anchor: middle;">[SectorID] ← LookupSectorByDealExpiry(Epoch)</text><path d="M 2675,4792 C 2735,4782 2735,4822 2675,4812" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2675" y="4850" class="messageText" style="text-anchor: middle;">PurgeSectorsWithNoLiveDeals([SectorID])</text><path d="M 2675,4857 C 2735,4847 2735,4887 2675,4877" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><line x1="1265" y1="4707" x2="2848.515625" y2="4707" class="loopLine"></line><line x1="2848.515625" y1="4707" x2="2848.515625" y2="4897" class="loopLine"></line><line x1="1265" y1="4897" x2="2848.515625" y2="4897" class="loopLine"></line><line x1="1265" y1="4707" x2="1265" y2="4897" class="loopLine"></line><polygon points="1265,4707 1315,4707 1315,4720 1306.6,4727 1265,4727" class="labelBox"></polygon><text x="1272.5" y="4722" fill="black" class="labelText"><tspan x="1272.5" fill="black">opt</tspan></text><text x="2056.7578125" y="4722" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2056.7578125" fill="black">[ Expired deals ]</tspan></text></g><g><rect x="4700" y="4907" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="4696" y="4931" fill="black" class="noteText"><tspan x="4716" fill="black">Schedule and resume PoSts</tspan></text></g><g><rect x="4700" y="4953" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="4696" y="4977" fill="black" class="noteText"><tspan x="4716" fill="black">Schedule and resume SEALs</tspan></text></g><g><rect x="4700" y="4999" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="4696" y="5023" fill="black" class="noteText"><tspan x="4716" fill="black">Process deal payments</tspan></text></g><g><rect x="4700" y="5045" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="4696" y="5069" fill="black" class="noteText"><tspan x="4716" fill="black">Maintain FaultSet</tspan></text></g><g><rect x="4700" y="5091" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="4696" y="5115" fill="black" class="noteText"><tspan x="4716" fill="black">Maintain DoneSet</tspan></text></g><g><line x1="1255" y1="4682" x2="4860" y2="4682" class="loopLine"></line><line x1="4860" y1="4682" x2="4860" y2="5137" class="loopLine"></line><line x1="1255" y1="5137" x2="4860" y2="5137" class="loopLine"></line><line x1="1255" y1="4682" x2="1255" y2="5137" class="loopLine"></line><polygon points="1255,4682 1305,4682 1305,4695 1296.6,4702 1255,4702" class="labelBox"></polygon><text x="1262.5" y="4697" fill="black" class="labelText"><tspan x="1262.5" fill="black">opt</tspan></text><text x="3057.5" y="4697" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3057.5" fill="black">[ MiningScheduler ]</tspan></text></g><g><rect x="3300" y="5172" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="3296" y="5196" fill="black" class="noteText"><tspan x="3316" fill="black">Close PendingArbitrations</tspan></text></g><g><line x1="3290" y1="5147" x2="3460" y2="5147" class="loopLine"></line><line x1="3460" y1="5147" x2="3460" y2="5218" class="loopLine"></line><line x1="3290" y1="5218" x2="3460" y2="5218" class="loopLine"></line><line x1="3290" y1="5147" x2="3290" y2="5218" class="loopLine"></line><polygon points="3290,5147 3340,5147 3340,5160 3331.6,5167 3290,5167" class="labelBox"></polygon><text x="3297.5" y="5162" fill="black" class="labelText"><tspan x="3297.5" fill="black">opt</tspan></text><text x="3375" y="5162" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3375" fill="black">[ ClockSubsystem ]</tspan></text></g><g><text x="3675" y="5296" class="messageText" style="text-anchor: middle;">UpdateSectorStatus([FaultSet], SectorStateSets)</text><line x1="4875" y1="5303" x2="2475" y2="5303" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2275" y="5331" class="messageText" style="text-anchor: middle;">RecomputeMinerPower()</text><line x1="2475" y1="5338" x2="2075" y2="5338" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="2500" y="5348" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="2496" y="5372" fill="black" class="noteText"><tspan x="2516" fill="black">SectorStateSets := (FaultSet, RecoverSet, ExpireSet)</tspan></text></g><g><line x1="2065" y1="5253" x2="4885" y2="5253" class="loopLine"></line><line x1="4885" y1="5253" x2="4885" y2="5394" class="loopLine"></line><line x1="2065" y1="5394" x2="4885" y2="5394" class="loopLine"></line><line x1="2065" y1="5253" x2="2065" y2="5394" class="loopLine"></line><polygon points="2065,5253 2115,5253 2115,5266 2106.6,5273 2065,5273" class="labelBox"></polygon><text x="2072.5" y="5268" fill="black" class="labelText"><tspan x="2072.5" fill="black">opt</tspan></text><text x="3475" y="5268" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3475" fill="black">[ Declaration within a Proving Period ]</tspan></text></g><g><text x="2375" y="5447" class="messageText" style="text-anchor: middle;">SubmitPoSt(PoStProof, SectorStateSets)</text><line x1="2275" y1="5454" x2="2475" y2="5454" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="2265" y1="5404" x2="2485" y2="5404" class="loopLine"></line><line x1="2485" y1="5404" x2="2485" y2="5464" class="loopLine"></line><line x1="2265" y1="5464" x2="2485" y2="5464" class="loopLine"></line><line x1="2265" y1="5404" x2="2265" y2="5464" class="loopLine"></line><polygon points="2265,5404 2315,5404 2315,5417 2306.6,5424 2265,5424" class="labelBox"></polygon><text x="2272.5" y="5419" fill="black" class="labelText"><tspan x="2272.5" fill="black">opt</tspan></text><text x="2375" y="5419" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2375" fill="black">[ Miner DID NOT win blocks this proving period -- deadline challenge ]</tspan></text></g><g><text x="3575" y="5517" class="messageText" style="text-anchor: middle;">VerifyPosts()</text><line x1="5075" y1="5524" x2="2075" y2="5524" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="2275" y="5602" class="messageText" style="text-anchor: middle;">ProvingPeriodUpdate()</text><line x1="2075" y1="5609" x2="2475" y2="5609" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g></g><g><text x="2480" y="5637" class="messageText" style="text-anchor: middle;">computeProvingPeriodEndSectorState()</text><path d="M 2480,5644 C 2540,5634 2540,5674 2480,5664" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><rect x="2500" y="5684" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="2496" y="5708" fill="black" class="noteText"><tspan x="2516" fill="black">FaultSet is all sectors if no post submitted</tspan></text></g><g><rect x="2500" y="5730" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="2496" y="5754" fill="black" class="noteText"><tspan x="2516" fill="black">sectors Faulted longer than threshold proving periods are destroyed</tspan></text></g><g><text x="2480" y="5794" class="messageText" style="text-anchor: middle;">UpdateSectorStatus(newSectorState)</text><path d="M 2480,5801 C 2540,5791 2540,5831 2480,5821" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="2272.5" y="5859" class="messageText" style="text-anchor: middle;">RecomputeMinerPower()</text><line x1="2470" y1="5866" x2="2075" y2="5866" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="3877.5" y="5894" class="messageText" style="text-anchor: middle;">StagePendingArbitration([newSectorState.DestroyedSet])</text><line x1="2480" y1="5901" x2="5275" y2="5901" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><line x1="2065" y1="5559" x2="5285" y2="5559" class="loopLine"></line><line x1="5285" y1="5559" x2="5285" y2="5911" class="loopLine"></line><line x1="2065" y1="5911" x2="5285" y2="5911" class="loopLine"></line><line x1="2065" y1="5559" x2="2065" y2="5911" class="loopLine"></line><polygon points="2065,5559 2115,5559 2115,5572 2106.6,5579 2065,5579" class="labelBox"></polygon><text x="2072.5" y="5574" fill="black" class="labelText"><tspan x="2072.5" fill="black">alt</tspan></text><text x="3675" y="5574" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3675" fill="black">[ if miner ProvingPeriod ends ]</tspan></text></g><g><line x1="2055" y1="5534" x2="5295" y2="5534" class="loopLine"></line><line x1="5295" y1="5534" x2="5295" y2="5921" class="loopLine"></line><line x1="2055" y1="5921" x2="5295" y2="5921" class="loopLine"></line><line x1="2055" y1="5534" x2="2055" y2="5921" class="loopLine"></line><polygon points="2055,5534 2105,5534 2105,5547 2096.6,5554 2055,5554" class="labelBox"></polygon><text x="2062.5" y="5549" fill="black" class="labelText"><tspan x="2062.5" fill="black">loop</tspan></text><text x="3675" y="5549" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3675" fill="black">[ forEach StorageMinerActor in StoragePowerActor.Miners ]</tspan></text></g><g><line x1="2045" y1="5474" x2="5305" y2="5474" class="loopLine"></line><line x1="5305" y1="5474" x2="5305" y2="5931" class="loopLine"></line><line x1="2045" y1="5931" x2="5305" y2="5931" class="loopLine"></line><line x1="2045" y1="5474" x2="2045" y2="5931" class="loopLine"></line><polygon points="2045,5474 2095,5474 2095,5487 2086.6,5494 2045,5494" class="labelBox"></polygon><text x="2052.5" y="5489" fill="black" class="labelText"><tspan x="2052.5" fill="black">loop</tspan></text><text x="3675" y="5489" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3675" fill="black">[ EveryBlock ]</tspan></text></g><g><line x1="2035" y1="5228" x2="5315" y2="5228" class="loopLine"></line><line x1="5315" y1="5228" x2="5315" y2="5941" class="loopLine"></line><line x1="2035" y1="5941" x2="5315" y2="5941" class="loopLine"></line><line x1="2035" y1="5228" x2="2035" y2="5941" class="loopLine"></line><polygon points="2035,5228 2085,5228 2085,5241 2076.6,5248 2035,5248" class="labelBox"></polygon><text x="2042.5" y="5243" fill="black" class="labelText"><tspan x="2042.5" fill="black">opt</tspan></text><text x="3675" y="5243" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3675" fill="black">[ Storage Fault ]</tspan></text></g><g><rect x="5500" y="5976" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="5496" y="6000" fill="black" class="noteText"><tspan x="5516" fill="black">Does storageCollateral live with StorageMarketActor, or storageMiningActor? Does pledgeCollateral (create separate consensus collateral) live with StorageMiningActor or StoragePowerActor.</tspan></text></g><g><text x="2875" y="6040" class="messageText" style="text-anchor: middle;">ArbitrateFault(SectorID, Deal)</text><line x1="475" y1="6047" x2="5275" y2="6047" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="5275" y="6075" class="messageText" style="text-anchor: middle;">PendingArbitration ← FindArbitrationBySector(Deal.Size, Deal.Amount, Arbitration.Amount)</text><path d="M 5275,6082 C 5335,6072 5335,6112 5275,6102" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="5275" y="6140" class="messageText" style="text-anchor: middle;">Amt ← CalculateCompensation(Deal.Size, Deal.Amount, Arbitration.Amount)</text><path d="M 5275,6147 C 5335,6137 5335,6177 5275,6167" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></path></g><g><text x="5275" y="6205" class="messageText" style="text-anchor: middle;">CompensateClient(Amt, StorageClient.Address)</text><path d="M 5275,6212 C 5335,6202 5335,6242 5275,6232" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></path></g><g><line x1="465" y1="5951" x2="5660" y2="5951" class="loopLine"></line><line x1="5660" y1="5951" x2="5660" y2="6252" class="loopLine"></line><line x1="465" y1="6252" x2="5660" y2="6252" class="loopLine"></line><line x1="465" y1="5951" x2="465" y2="6252" class="loopLine"></line><polygon points="465,5951 515,5951 515,5964 506.6,5971 465,5971" class="labelBox"></polygon><text x="472.5" y="5966" fill="black" class="labelText"><tspan x="472.5" fill="black">opt</tspan></text><text x="3062.5" y="5966" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="3062.5" fill="black">[ FaultArbitration ]</tspan></text></g><g><text x="2272.5" y="6305" class="messageText" style="text-anchor: middle;">DeclareConsensusFault(ConsensusFaultProof)</text><line x1="2470" y1="6312" x2="2075" y2="6312" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1975" y="6340" class="messageText" style="text-anchor: middle;">ValidateFault(ConsensusFaultProof)</text><line x1="2075" y1="6347" x2="1875" y2="6347" class="messageLine1" stroke-width="2" stroke="black" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><rect x="1870" y="6349" fill="#f4f4f4" stroke="#666" width="10" height="128" rx="0" ry="0"></rect></g><g><text x="1977.5" y="6400" class="messageText" style="text-anchor: middle;">TerminateMiner(Address)</text><line x1="1880" y1="6407" x2="2075" y2="6407" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="1977.5" y="6435" class="messageText" style="text-anchor: middle;">SlashPledgeCollateral(Address)</text><line x1="1880" y1="6442" x2="2075" y2="6442" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="2175" y="6470" class="messageText" style="text-anchor: middle;">UpdateBalance(Reward)</text><line x1="1880" y1="6477" x2="2470" y2="6477" class="messageLine1" stroke-width="2" stroke="black" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><line x1="1860" y1="6357" x2="2490" y2="6357" class="loopLine"></line><line x1="2490" y1="6357" x2="2490" y2="6487" class="loopLine"></line><line x1="1860" y1="6487" x2="2490" y2="6487" class="loopLine"></line><line x1="1860" y1="6357" x2="1860" y2="6487" class="loopLine"></line><polygon points="1860,6357 1910,6357 1910,6370 1901.6,6377 1860,6377" class="labelBox"></polygon><text x="1867.5" y="6372" fill="black" class="labelText"><tspan x="1867.5" fill="black">alt</tspan></text><text x="2175" y="6372" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2175" fill="black">[ ValidFault ]</tspan></text></g><g><line x1="1850" y1="6262" x2="2500" y2="6262" class="loopLine"></line><line x1="2500" y1="6262" x2="2500" y2="6497" class="loopLine"></line><line x1="1850" y1="6497" x2="2500" y2="6497" class="loopLine"></line><line x1="1850" y1="6262" x2="1850" y2="6497" class="loopLine"></line><polygon points="1850,6262 1900,6262 1900,6275 1891.6,6282 1850,6282" class="labelBox"></polygon><text x="1857.5" y="6277" fill="black" class="labelText"><tspan x="1857.5" fill="black">opt</tspan></text><text x="2175" y="6277" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="2175" fill="black">[ ConsensusFault ]</tspan></text></g><g><rect x="0" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">RetrievalClient</tspan></text></g><g><rect x="200" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">RetrievalProvider</tspan></text></g><g><rect x="400" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">StorageClient</tspan></text></g><g><rect x="600" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="675" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="675" dy="0">StorageProvider</tspan></text></g><g><rect x="800" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="875" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="875" dy="0">PaymentChannelActor</tspan></text></g><g><rect x="1000" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1075" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1075" dy="0">PaymentsSubsystem</tspan></text></g><g><rect x="1200" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1275" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1275" dy="0">BlockchainSubsystem</tspan></text></g><g><rect x="1400" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1475" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1475" dy="0">BlockSyncer</tspan></text></g><g><rect x="1600" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1675" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1675" dy="0">BlockProducer</tspan></text></g><g><rect x="1800" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1875" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="1875" dy="0">StoragePowerConsensusSubsystem</tspan></text></g><g><rect x="2000" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2075" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2075" dy="0">StoragePowerActor</tspan></text></g><g><rect x="2200" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2275" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2275" dy="0">StorageMiningSubsystem</tspan></text></g><g><rect x="2400" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2475" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2475" dy="0">StorageMinerActor</tspan></text></g><g><rect x="2600" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2675" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2675" dy="0">SectorIndexerSubsystem</tspan></text></g><g><rect x="2800" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2875" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="2875" dy="0">StorageProvingSubsystem</tspan></text></g><g><rect x="3000" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3075" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3075" dy="0">FilecoinProofsSubsystem</tspan></text></g><g><rect x="3200" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3275" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3275" dy="0">ClockSubsystem</tspan></text></g><g><rect x="3400" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3475" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3475" dy="0">libp2p</tspan></text></g><g><rect x="3600" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3675" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3675" dy="0">SectorSealer</tspan></text></g><g><rect x="3800" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="3875" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="3875" dy="0">PoStSubmission</tspan></text></g><g><rect x="4000" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4075" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4075" dy="0">WallClock</tspan></text></g><g><rect x="4200" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4275" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4275" dy="0">Blockchain</tspan></text></g><g><rect x="4400" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4475" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4475" dy="0">MessagePool</tspan></text></g><g><rect x="4600" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4675" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4675" dy="0">MiningScheduler</tspan></text></g><g><rect x="4800" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="4875" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="4875" dy="0">StorageMinerSubsystem</tspan></text></g><g><rect x="5000" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="5075" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="5075" dy="0">CronActor</tspan></text></g><g><rect x="5200" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="5275" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="5275" dy="0">StorageMarketActor</tspan></text></g><g><rect x="5400" y="6517" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="5475" y="6549.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="5475" dy="0">FaultArbitration</tspan></text></g></svg>